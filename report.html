<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Report</title>

<style>
:root{
  --primary:#1e3a8a;
  --bg:#f1f5f9;
  --card:#ffffff;
  --green:#22c55e;
}
body{
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
  margin:0;
  padding:30px;
}

/* LOGIN */
.login-box{
  max-width:360px;
  margin:120px auto;
  background:#fff;
  padding:30px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.1);
  text-align:center;
}
.login-box h2{
  margin-bottom:20px;
  color:var(--primary);
}
.login-box input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  margin-bottom:15px;
}
.login-box button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.error{
  color:red;
  font-size:14px;
  display:none;
}

/* MAIN */
.container{
  background:var(--card);
  border-radius:16px;
  padding:25px;
  box-shadow:0 20px 40px rgba(0,0,0,.08);
}
h1{color:var(--primary)}

.header{
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:center;
  gap:15px;
}
.actions{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
input,button{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #cbd5e1;
}
button{
  background:#e2e8f0;
  color:#1e293b;
  font-weight:600;
  cursor:pointer;
}
button.primary{
  background:var(--primary);
  color:#fff;
}
button.preset.active{
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

/* REPORT */
.report{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin:25px 0;
}
.card{
  background:#f8fafc;
  border-radius:14px;
  padding:18px;
}
.card h3{margin:0 0 8px;font-size:14px;color:#475569}
.card .value{font-size:22px;font-weight:700;color:var(--green)}

table{width:100%;border-collapse:collapse}
th{background:var(--primary);color:#fff;padding:10px}
td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:center}

@media print{
  .actions{display:none}
  body{padding:0;background:#fff}
  .container{box-shadow:none;border-radius:0}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login-box" id="loginBox">
  <h2>üîê Login Admin</h2>
  <input type="password" id="password" placeholder="Masukkan password">
  <button onclick="login()">Login</button>
  <div class="error" id="error">Password salah</div>
</div>

<!-- MAIN CONTENT -->
<div class="container" id="mainContent" style="display:none">

  <div class="header">
    <div>
      <h1>üìä Report Pemasukan</h1>
      <small id="periodeText">Periode: Semua Data</small>
    </div>

    <div class="actions">
      <button class="preset" onclick="setToday(this)">Hari Ini</button>
      <button class="preset" onclick="setWeek(this)">Minggu Ini</button>
      <button class="preset" onclick="setMonth(this)">Bulan Ini</button>
      <button class="preset" onclick="setYear(this)">Tahun Ini</button>
      <input type="date" id="startDate" onchange="clearPreset()">
      <input type="date" id="endDate" onchange="clearPreset()">
      <button class="primary" onclick="loadReport()">Tampilkan</button>
      <button class="primary" onclick="window.print()">üñ® Cetak</button>
    </div>
  </div>

  <div class="report">
    <div class="card">
      <h3>Total Omzet</h3>
      <div class="value" id="totalOmzet">Rp 0</div>
    </div>
    <div class="card">
      <h3>Total Booking</h3>
      <div class="value" id="confirmedCount">0</div>
    </div>
  </div>

  <h3>üìã Rekap per Kamar</h3>
  <table>
    <thead>
      <tr>
        <th>Kamar</th>
        <th>Total Malam</th>
        <th>Pemasukan</th>
      </tr>
    </thead>
    <tbody id="roomReport"></tbody>
  </table>

</div>

<script>
/* LOGIN */
const PASSWORD = "superadmin";

function login(){
  const pass = document.getElementById("password").value;
  if(pass === PASSWORD){
    sessionStorage.setItem("login","ok");
    showMain();
  }else{
    error.style.display="block";
  }
}

function showMain(){
  loginBox.style.display="none";
  mainContent.style.display="block";
}

/* AUTO LOGIN */
if(sessionStorage.getItem("login")==="ok"){
  showMain();
}

/* KONFIG */
const API_URL="https://script.google.com/macros/s/AKfycbyGQU4yC6Nf2Qy4li5KaMqk3mrnV7QDpbMj5DLHbHzROC0g7sP-Z2znO2EGNtBZs3Sd9A/exec";
const HARGA={
  "Standard Room":250000,
  "Deluxe Room":400000,
  "Family Room":600000
};

const parseTanggal=v=>{
  if(v.includes("T")) return new Date(v);
  const p=v.includes("/")?v.split("/") : v.split("-");
  return p[0].length===4
    ? new Date(p[0],p[1]-1,p[2])
    : new Date(p[2],p[1]-1,p[0]);
};
const malam=(a,b)=>Math.max(1,Math.round((b-a)/86400000));
const rupiah=v=>"Rp "+v.toLocaleString("id-ID");

function setActivePreset(btn){
  document.querySelectorAll(".preset").forEach(b=>b.classList.remove("active"));
  if(btn) btn.classList.add("active");
}
function clearPreset(){ setActivePreset(null); }

function setToday(btn){
  const t=new Date().toISOString().slice(0,10);
  startDate.value=t;
  endDate.value=t;
  setActivePreset(btn);
  loadReport();
}
function setWeek(btn){
  const now=new Date();
  const day=now.getDay()||7;
  const monday=new Date(now);
  monday.setDate(now.getDate()-day+1);
  const sunday=new Date(monday);
  sunday.setDate(monday.getDate()+6);
  startDate.value=monday.toISOString().slice(0,10);
  endDate.value=sunday.toISOString().slice(0,10);
  setActivePreset(btn);
  loadReport();
}
function setMonth(btn){
  const now=new Date();
  startDate.value=new Date(now.getFullYear(),now.getMonth(),1).toISOString().slice(0,10);
  endDate.value=new Date(now.getFullYear(),now.getMonth()+1,0).toISOString().slice(0,10);
  setActivePreset(btn);
  loadReport();
}
function setYear(btn){
  const y=new Date().getFullYear();
  startDate.value=`${y}-01-01`;
  endDate.value=`${y}-12-31`;
  setActivePreset(btn);
  loadReport();
}

function loadReport(){
  fetch(API_URL).then(r=>r.json()).then(r=>{
    const data=r.data||[];
    let total=0, confirmed=0;
    const room={};

    data.forEach(d=>{
      if(d.status!=="Confirmed") return;
      const ci=parseTanggal(d.checkin);
      const co=parseTanggal(d.checkout);
      const m=malam(ci,co);
      const income=HARGA[d.kamar]*m;

      confirmed++;
      total+=income;
      if(!room[d.kamar]) room[d.kamar]={malam:0,total:0};
      room[d.kamar].malam+=m;
      room[d.kamar].total+=income;
    });

    totalOmzet.innerText=rupiah(total);
    confirmedCount.innerText=confirmed;

    roomReport.innerHTML="";
    for(const k in room){
      roomReport.innerHTML+=`
        <tr>
          <td>${k}</td>
          <td>${room[k].malam}</td>
          <td>${rupiah(room[k].total)}</td>
        </tr>`;
    }
  });
}

</script>
</body>
</html>
